{% load listings_tags %}

{% for listing in filter.qs %}
<div class="col">
    <div class="listing-card">
        <a href="{{ listing.get_absolute_url }}">
            <div class="listing-card-image-container">
                {% if listing.images.first %}
                <img src="{{ listing.images.first.image.url }}" class="listing-card-image" alt="{{ listing.title }}">
                {% else %}
                <div class="listing-card-placeholder">
                    <span>No Image</span>
                </div>
                {% endif %}
                <div class="listing-card-save">
                    {% if user.is_authenticated %}
                    <button class="btn btn-sm save-button" data-listing-id="{{ listing.pk }}" aria-label="Save Listing">
                        {% if listing.pk in saved_listing_ids %}
                        <i class="fas fa-heart text-danger"></i>
                        {% else %}
                        <i class="far fa-heart"></i>
                        {% endif %}
                    </button>
                    {% endif %}
                </div>
            </div>
        </a>
        <div class="listing-card-body">
            <div class="listing-card-header">
                <a href="{{ listing.get_absolute_url }}" class="text-decoration-none text-dark">
                    <h5 class="listing-card-title">{{ listing.title }}</h5>
                </a>
                <span class="listing-card-price">â‚±{{ listing.price|philippine_currency }}</span>
            </div>
            <div class="listing-card-footer">
                <div class="listing-card-seller">
                    <img src="{{ listing.seller.profile.avatar.url }}" class="listing-card-avatar" alt="{{ listing.seller.username }}'s avatar">
                    <a href="{% url 'accounts:public_profile' username=listing.seller.username %}" class="listing-card-seller-name">{{ listing.seller.username }}</a>
                </div>
                {% if listing.average_rating %}
                <div class="listing-card-rating">
                    {% for i in "12345"|make_list %}
                    <i class="{% if forloop.counter <= listing.average_rating %}fas{% else %}far{% endif %} fa-star"></i>
                    {% endfor %}
                </div>
                {% else %}
                <span class="text-muted small">No ratings</span>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% empty %}
<div class="col-12">
    <p class="text-center">No listings found. Try adjusting your filters!</p>
</div>
{% endfor %}